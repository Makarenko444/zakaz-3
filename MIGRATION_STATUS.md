# –ú–∏–≥—Ä–∞—Ü–∏—è 024: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü - –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

## ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. SQL –º–∏–≥—Ä–∞—Ü–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `024_merge_addresses_into_nodes.sql`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω enum `presence_type` (has_node, has_ao, has_transit_cable, not_present)
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `zakaz_nodes` –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
- ‚úÖ –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `zakaz_addresses`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –≤ `zakaz_applications`
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π —Ç–∞–±–ª–∏—Ü—ã

### 2. TypeScript —Ç–∏–ø—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–∏–ø `PresenceType` –≤ `lib/types.ts`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Node` (–¥–æ–±–∞–≤–ª–µ–Ω—ã street, house, comment, presence_type)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Application` (address_id ‚Üí node_id)

### 3. API Backend
- ‚úÖ `/api/addresses/route.ts` - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å zakaz_nodes
- ‚úÖ `/api/addresses/search/route.ts` - –ø–æ–∏—Å–∫ –≤ zakaz_nodes
- ‚úÖ `/api/addresses/save-external/route.ts` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ zakaz_nodes

### 4. UI Frontend
- ‚úÖ `app/dashboard/applications/[id]/edit/page.tsx` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
- ‚úÖ `app/dashboard/applications/[id]/page.tsx` - –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–∫–∏ –∏ –º–∞—Å—Ç–µ—Ä –ø—Ä–∏–≤—è–∑–∫–∏
- ‚úÖ `app/dashboard/applications/page.tsx` - —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `database/migrations/README_024.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `MIGRATION_024_SUMMARY.md` - –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ `MIGRATION_STATUS.md` - —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

### 6. Git
- ‚úÖ –î–≤–∞ –∫–æ–º–º–∏—Ç–∞ —Å–æ–∑–¥–∞–Ω—ã –∏ –∑–∞–ø—É—à–µ–Ω—ã –≤ –≤–µ—Ç–∫—É `claude/merge-address-tables-01JnCEwCnPwwHL8xCnL9snHo`

## ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è

### 1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç AddressLinkWizard
**–§–∞–π–ª:** `app/components/AddressLinkWizard.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
// –ë–´–õ–û:
currentAddressId?: string | null

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
currentNodeId?: string | null
```

–≠—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `app/dashboard/applications/[id]/page.tsx` –∏ —É–∂–µ –ø–µ—Ä–µ–¥–∞–µ—Ç `currentNodeId`, –Ω–æ —Å–∞–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω.

### 2. API endpoints –¥–ª—è –∑–∞—è–≤–æ–∫
**–§–∞–π–ª—ã:**
- `app/api/applications/route.ts` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫
- `app/api/applications/[id]/route.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ó–∞–º–µ–Ω–∏—Ç—å `address_id` –Ω–∞ `node_id` –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ –ë–î
- –û–±–Ω–æ–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é

### 3. –ê–¥–º–∏–Ω–∫–∞ –∞–¥—Ä–µ—Å–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
**–§–∞–π–ª—ã:**
- `app/api/admin/addresses/[id]/route.ts`
- –í–æ–∑–º–æ–∂–Ω–æ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–¥–º–∏–Ω–∫–∏

## üîß –ö–∞–∫ –∑–∞–≤–µ—Ä—à–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ –ë–î

**–í–∞–∂–Ω–æ:** –°–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º!

```bash
# –ß–µ—Ä–µ–∑ Supabase Dashboard:
# 1. SQL Editor ‚Üí New query
# 2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ database/migrations/024_merge_addresses_into_nodes.sql
# 3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### AddressLinkWizard.tsx
```bash
# –ù–∞–π—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
find app/components -name "*Address*" -o -name "*address*"

# –û–±–Ω–æ–≤–∏—Ç—å props: currentAddressId ‚Üí currentNodeId
```

#### API endpoints
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã
app/api/applications/route.ts
app/api/applications/[id]/route.ts

# –ó–∞–º–µ–Ω–∏—Ç—å address_id –Ω–∞ node_id –≤:
# - INSERT –∑–∞–ø—Ä–æ—Å–∞—Ö
# - UPDATE –∑–∞–ø—Ä–æ—Å–∞—Ö
# - SELECT —Å JOIN
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
```sql
-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã
\d zakaz_nodes

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è
SELECT presence_type, COUNT(*) FROM zakaz_nodes GROUP BY presence_type;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫
SELECT COUNT(*) FROM zakaz_applications WHERE node_id IS NOT NULL;
```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å UI:**
- –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞—è–≤–∫—É
- –ü—Ä–∏–≤—è–∑–∞—Ç—å –∞–¥—Ä–µ—Å —á–µ—Ä–µ–∑ –º–∞—Å—Ç–µ—Ä
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –ø–æ –∞–¥—Ä–µ—Å—É –≤ —Å–ø–∏—Å–∫–µ –∑–∞—è–≤–æ–∫
- –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞—è–≤–∫—É

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API:**
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
curl -X POST /api/applications -H "Content-Type: application/json" -d '{"node_id": "...", ...}'

# –ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–æ–≤
curl /api/addresses/search?query=–ª–µ–Ω–∏–Ω–∞

# –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º
curl /api/applications?node_id=xxx
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 10
- **–°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** ~150
- **–°—Ç—Ä–æ–∫ —É–¥–∞–ª–µ–Ω–æ:** ~80
- **–ù–æ–≤—ã—Ö —Ç–∏–ø–æ–≤:** 1 (PresenceType)
- **–ö–æ–º–º–∏—Ç–æ–≤:** 2

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –≤—Å–µ—Ö –∞–¥—Ä–µ—Å–æ–≤
- ‚úÖ –ß–µ—Ç–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ä–∞–∑–≤–∏–≤–∞—Ç—å
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å–µ—Ç–∏

## üìù –°–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è

1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ –ë–î (Supabase Dashboard)
2. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç AddressLinkWizard
3. –û–±–Ω–æ–≤–∏—Ç—å API –¥–ª—è –∑–∞—è–≤–æ–∫ (applications)
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
5. –°–æ–∑–¥–∞—Ç—å PR –¥–ª—è —Ä–µ–≤—å—é

---

**–í–æ–ø—Ä–æ—Å—ã?** –°–º. `database/migrations/README_024.md` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
