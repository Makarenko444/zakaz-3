# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ VPS

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è —á–µ—Ä–µ–∑ GitHub Actions –Ω–∞ –≤–∞—à VPS.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–∏ push –≤ GitHub
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (health check)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –¥–µ–ø–ª–æ–µ–º
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –¥–µ–ø–ª–æ—è

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1Ô∏è‚É£ –°–æ–∑–¥–∞–π—Ç–µ SSH –∫–ª—é—á –¥–ª—è GitHub Actions

–ù–∞ –≤–∞—à–µ–º **–ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ** –∏–ª–∏ **–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π SSH –∫–ª—é—á (–±–µ–∑ –ø–∞—Ä–æ–ª—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏)
ssh-keygen -t ed25519 -C "github-actions-zakaz3" -f ~/.ssh/github_actions_zakaz3 -N ""

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (–ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è GitHub Secrets)
cat ~/.ssh/github_actions_zakaz3

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (–¥–æ–±–∞–≤–∏–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
cat ~/.ssh/github_actions_zakaz3.pub
```

### 2Ô∏è‚É£ –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ VPS

–ù–∞ –≤–∞—à–µ–º **VPS** (ssh makarenko@78.140.57.33):

```bash
# –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ authorized_keys
echo "ssh-ed25519 AAAA... github-actions-zakaz3" >> ~/.ssh/authorized_keys

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

### 3Ô∏è‚É£ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

–ù–∞ –≤–∞—à–µ–º **–ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ**:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–æ–∂–µ—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å –Ω–æ–≤—ã–º –∫–ª—é—á–æ–º
ssh -i ~/.ssh/github_actions_zakaz3 makarenko@78.140.57.33 "echo 'Connection successful!'"
```

### 4Ô∏è‚É£ –î–æ–±–∞–≤—å—Ç–µ GitHub Secrets

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
3. –ù–∞–∂–º–∏—Ç–µ **New repository secret** –∏ –¥–æ–±–∞–≤—å—Ç–µ:

**VPS_HOST:**
```
78.140.57.33
```

**VPS_USERNAME:**
```
makarenko
```

**VPS_SSH_KEY:**
```
(–≤—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ ~/.ssh/github_actions_zakaz3 - –ü–†–ò–í–ê–¢–ù–´–ô –∫–ª—é—á)
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
...
-----END OPENSSH PRIVATE KEY-----
```

### 5Ô∏è‚É£ –°–æ–∑–¥–∞–π—Ç–µ deployment —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ù–∞ –≤–∞—à–µ–º **VPS**:

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
cd ~/apps/zakaz-3
git pull

# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤ –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
mkdir -p scripts

# –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x scripts/deploy-server.sh

# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –±—ç–∫–∞–ø–æ–≤
mkdir -p ~/backups/zakaz-3
```

### 6Ô∏è‚É£ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –¥–µ–ø–ª–æ–π –≤—Ä—É—á–Ω—É—é

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ deployment —Å–∫—Ä–∏–ø—Ç –≤—Ä—É—á–Ω—É—é
cd ~/apps/zakaz-3
./scripts/deploy-server.sh
```

–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–∫—Ä–∏–ø—Ç:
1. –°–¥–µ–ª–∞–µ—Ç –±—ç–∫–∞–ø
2. –°–∫–∞—á–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ GitHub
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
4. –°–æ–±–µ—Ä—ë—Ç –ø—Ä–æ–µ–∫—Ç
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç PM2
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

### 7Ô∏è‚É£ –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏ –∑–∞–ø—É—à—å—Ç–µ workflow

–ù–∞ –≤–∞—à–µ–º **–ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ**:

```bash
cd /path/to/zakaz-3

# –î–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª—ã
git add .github/workflows/deploy.yml
git add scripts/deploy-server.sh
git add AUTO_DEPLOYMENT.md

# –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ
git commit -m "feat: add auto-deployment via GitHub Actions"

# –ó–∞–ø—É—à—å—Ç–µ
git push origin your-branch-name
```

### 8Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –∞–≤—Ç–æ–¥–µ–ø–ª–æ—è

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é workflow —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞:
- Push –≤ –≤–µ—Ç–∫—É `main`
- Push –≤ –≤–µ—Ç–∫—É `claude/check-deployment-vm-011CUKpxfjRcBBSuLxQLeZBp`

–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.github/workflows/deploy.yml`:

```yaml
on:
  push:
    branches:
      - main  # <-- –ò–∑–º–µ–Ω–∏—Ç–µ –∑–¥–µ—Å—å
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

–ü—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–π—Ç–µ push –≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –≤–µ—Ç–∫—É:

```bash
git add .
git commit -m "feat: new feature"
git push origin main
```

GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ VPS –ø–æ SSH
2. –ó–∞–ø—É—Å—Ç–∏—Ç deployment —Å–∫—Ä–∏–ø—Ç
3. –í—ã–ø–æ–ª–Ω–∏—Ç –¥–µ–ø–ª–æ–π
4. –ü–æ–∫–∞–∂–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ GitHub

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ GitHub ‚Üí **Actions**
2. –í—ã–±–µ—Ä–∏—Ç–µ workflow **Deploy to VPS**
3. –ù–∞–∂–º–∏—Ç–µ **Run workflow**
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É
5. –ù–∞–∂–º–∏—Ç–µ **Run workflow**

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
ssh makarenko@78.140.57.33
cd ~/apps/zakaz-3
./scripts/deploy-server.sh main  # –∏–ª–∏ –¥—Ä—É–≥—É—é –≤–µ—Ç–∫—É
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–ª–æ—è

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ GitHub Actions

1. –û—Ç–∫—Ä–æ–π—Ç–µ GitHub ‚Üí **Actions**
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫ workflow
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# PM2 –ª–æ–≥–∏
pm2 logs zakaz-3

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
pm2 logs zakaz-3 --lines 100

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
pm2 logs zakaz-3 --err
```

## Rollback (–æ—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback

–ï—Å–ª–∏ health check –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç, —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–∞—Ç–∏—Ç—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏.

### –†—É—á–Ω–æ–π rollback

```bash
ssh makarenko@78.140.57.33
cd ~/apps/zakaz-3

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∫–æ–º–º–∏—Ç–æ–≤
git log --oneline -10

# –û—Ç–∫–∞—Ç–∏—Ç–µ—Å—å –∫ –Ω—É–∂–Ω–æ–º—É –∫–æ–º–º–∏—Ç—É
git reset --hard <commit-hash>

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ
npm ci
npm run build
pm2 restart zakaz-3

# –ò–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –±—ç–∫–∞–ø–∞
ls ~/backups/zakaz-3/
cp -r ~/backups/zakaz-3/backup-YYYYMMDD-HHMMSS ~/apps/zakaz-3/.next
pm2 restart zakaz-3
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω
ssh -i ~/.ssh/github_actions_zakaz3 -v makarenko@78.140.57.33

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã
ls -la ~/.ssh/

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# -rw------- authorized_keys (600)
# drwx------ .ssh (700)
```

### –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π

```bash
# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ PM2
pm2 logs zakaz-3 --lines 200

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ .env —Ñ–∞–π–ª –Ω–∞ –º–µ—Å—Ç–µ
cat ~/apps/zakaz-3/.env

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ
df -h

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–º—è—Ç—å
free -h
```

### Build –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π –ø–∞–º—è—Ç–∏

–ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –º–∞–ª–æ –ø–∞–º—è—Ç–∏, –º–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
npm run build

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ .next –Ω–∞ —Å–µ—Ä–≤–µ—Ä
rsync -avz .next/ makarenko@78.140.57.33:~/apps/zakaz-3/.next/

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
ssh makarenko@78.140.57.33 "pm2 restart zakaz-3"
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

–î–æ–±–∞–≤—å—Ç–µ –≤ `.github/workflows/deploy.yml`:

```yaml
- name: Send Telegram notification
  if: always()
  uses: appleboy/telegram-action@master
  with:
    to: ${{ secrets.TELEGRAM_CHAT_ID }}
    token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
    message: |
      üöÄ Deployment ${{ job.status }}
      Repository: ${{ github.repository }}
      Branch: ${{ github.ref_name }}
      Commit: ${{ github.sha }}
      URL: https://zakaz2.tomica.ru
```

### Deploy preview –¥–ª—è feature –≤–µ—Ç–æ–∫

–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–π –≤–µ—Ç–∫–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä—Ç–∞—Ö.

### –¢–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

–î–æ–±–∞–≤—å—Ç–µ –≤ workflow –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:

```yaml
- name: Run tests
  run: |
    npm install
    npm test
```

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [SSH Action](https://github.com/appleboy/ssh-action)
- [PM2 Documentation](https://pm2.keymetrics.io/)
