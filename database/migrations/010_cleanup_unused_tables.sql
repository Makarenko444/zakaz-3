-- Миграция: Очистка неиспользуемых таблиц
-- Дата: 2025-11-14
-- Описание: Удаление устаревших и неиспользуемых таблиц из базы данных
-- Статус: ВЫПОЛНЕНО

-- =====================================================
-- КОНТЕКСТ И ПРИЧИНЫ ОЧИСТКИ
-- =====================================================

-- После анализа технической спецификации и реального использования таблиц
-- были выявлены следующие проблемы:
--
-- 1. УСТАРЕВШИЕ ТАБЛИЦЫ (заменены на новые):
--    - zakaz_comments -> заменена на zakaz_application_comments
--    - zakaz_comment_files -> не используется (0 строк)
--    - zakaz_application_files -> не используется (0 строк)
--
-- 2. НЕРЕАЛИЗОВАННЫЙ ФУНКЦИОНАЛ (из техзадания, но не внедрен):
--    - zakaz_brigades -> управление монтажными бригадами (1 строка)
--    - zakaz_brigade_members -> состав бригад (1 строка)
--    - zakaz_work_slots -> планирование работ (0 строк)
--
-- 3. ПРОБЛЕМЫ С ВНЕШНИМИ КЛЮЧАМИ:
--    - zakaz_files.comment_id ссылался на zakaz_comments вместо zakaz_application_comments
--    - Это было исправлено в отдельной миграции

-- =====================================================
-- УДАЛЕНИЕ УСТАРЕВШИХ ТАБЛИЦ
-- =====================================================

-- 1. zakaz_comments (заменена на zakaz_application_comments)
-- Данные: 0 строк
-- Использование: нет (код использует zakaz_application_comments)
DROP TABLE IF EXISTS zakaz_comments CASCADE;

-- 2. zakaz_comment_files (не используется)
-- Данные: 0 строк
-- Использование: нет
DROP TABLE IF EXISTS zakaz_comment_files CASCADE;

-- 3. zakaz_application_files (не используется)
-- Данные: 0 строк
-- Использование: нет (файлы хранятся в zakaz_files)
DROP TABLE IF EXISTS zakaz_application_files CASCADE;

-- =====================================================
-- УДАЛЕНИЕ ТАБЛИЦ НЕРЕАЛИЗОВАННЫХ ФУНКЦИЙ
-- =====================================================

-- 4. zakaz_work_slots (планирование работ не реализовано)
-- Данные: 0 строк
-- Планы: возможно будет реализовано в Фазе 2 (см. TECHNICAL_SPECIFICATION.md)
DROP TABLE IF EXISTS zakaz_work_slots CASCADE;

-- 5. zakaz_brigade_members (управление бригадами не реализовано)
-- Данные: 1 строка (тестовая)
-- Планы: возможно будет реализовано в Фазе 2 (см. TECHNICAL_SPECIFICATION.md)
DROP TABLE IF EXISTS zakaz_brigade_members CASCADE;

-- 6. zakaz_brigades (монтажные бригады не реализованы)
-- Данные: 1 строка (тестовая)
-- Планы: возможно будет реализовано в Фазе 2 (см. TECHNICAL_SPECIFICATION.md)
DROP TABLE IF EXISTS zakaz_brigades CASCADE;

-- =====================================================
-- ИТОГОВОЕ СОСТОЯНИЕ БАЗЫ ДАННЫХ
-- =====================================================

-- После выполнения миграции остаются следующие 9 активных таблиц:
--
-- 1. zakaz_users (4 записи) - пользователи системы
-- 2. zakaz_addresses (12 записей) - адреса объектов
-- 3. zakaz_applications (6 записей) - заявки клиентов
-- 4. zakaz_application_statuses (10 записей) - справочник статусов
-- 5. zakaz_application_status_history (31 запись) - история изменения статусов
-- 6. zakaz_application_comments (7 записей) - комментарии к заявкам
-- 7. zakaz_files (8 записей) - файлы заявок и комментариев
-- 8. zakaz_sessions (5 записей) - пользовательские сессии
-- 9. zakaz_audit_log (24 записи) - журнал аудита

-- =====================================================
-- ПРИМЕЧАНИЯ
-- =====================================================

-- 1. Эта миграция необратима (нет rollback).
-- 2. Удаленные таблицы были пустыми или содержали только тестовые данные.
-- 3. Если в будущем понадобятся brigades/work_slots - создадим их заново.
-- 4. README.md обновлен с правильными названиями таблиц.
-- 5. Все зависимые внешние ключи удалены автоматически (CASCADE).

-- Дата выполнения: 2025-11-14
-- Выполнено на: production (zakaz2.tomica.ru)
