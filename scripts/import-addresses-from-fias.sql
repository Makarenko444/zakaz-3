-- Скрипт для импорта адресов Томска из ФИАС
--
-- Инструкция:
-- 1. Скачать данные ФИАС для Томской области с https://fias.nalog.ru/
-- 2. Извлечь файлы AS_ADDR_OBJ_*.XML и AS_HOUSE_*.XML
-- 3. Использовать этот скрипт для импорта

-- ВАРИАНТ 1: Если есть готовый CSV файл с адресами
-- Формат CSV: street,house,comment
--
-- Пример CSV:
-- "ул. Ленина","5",""
-- "ул. Ленина","7",""
-- "пр. Фрунзе","10","Торговый центр"

-- Создаем временную таблицу для импорта
CREATE TEMP TABLE temp_addresses (
  street TEXT,
  house TEXT,
  comment TEXT
);

-- Загружаем данные из CSV
-- COPY temp_addresses FROM '/path/to/tomsk_addresses.csv' WITH (FORMAT csv, HEADER true);

-- Вставляем в основную таблицу (пропуская дубликаты)
INSERT INTO zakaz_addresses (street, house, comment)
SELECT DISTINCT street, house, comment
FROM temp_addresses
WHERE NOT EXISTS (
  SELECT 1 FROM zakaz_addresses za
  WHERE za.street = temp_addresses.street
    AND za.house = temp_addresses.house
)
ORDER BY street, house;

-- ВАРИАНТ 2: Ручная вставка типичных адресов Томска (для тестирования)
INSERT INTO zakaz_addresses (street, house, comment) VALUES
  -- Центральные улицы
  ('ул. Ленина', '1', NULL),
  ('ул. Ленина', '2', NULL),
  ('ул. Ленина', '3', NULL),
  ('ул. Ленина', '5', NULL),
  ('ул. Ленина', '7', NULL),
  ('ул. Ленина', '9', NULL),
  ('ул. Ленина', '50', NULL),
  ('ул. Ленина', '100', NULL),

  ('пр. Ленина', '30', NULL),
  ('пр. Ленина', '40', NULL),
  ('пр. Ленина', '50', NULL),
  ('пр. Ленина', '60', NULL),
  ('пр. Ленина', '70', NULL),
  ('пр. Ленина', '80', NULL),
  ('пр. Ленина', '90', NULL),
  ('пр. Ленина', '100', NULL),
  ('пр. Ленина', '110', NULL),
  ('пр. Ленина', '120', NULL),
  ('пр. Ленина', '130', NULL),
  ('пр. Ленина', '140', NULL),

  ('пр. Фрунзе', '1', NULL),
  ('пр. Фрунзе', '5', NULL),
  ('пр. Фрунзе', '10', NULL),
  ('пр. Фрунзе', '15', NULL),
  ('пр. Фрунзе', '20', NULL),
  ('пр. Фрунзе', '103', NULL),

  ('ул. Киевская', '1', NULL),
  ('ул. Киевская', '10', NULL),
  ('ул. Киевская', '20', NULL),
  ('ул. Киевская', '30', NULL),
  ('ул. Киевская', '40', NULL),
  ('ул. Киевская', '50', NULL),
  ('ул. Киевская', '60', NULL),
  ('ул. Киевская', '70', NULL),
  ('ул. Киевская', '80', NULL),
  ('ул. Киевская', '90', NULL),

  ('ул. Нахимова', '1', NULL),
  ('ул. Нахимова', '5', NULL),
  ('ул. Нахимова', '8', NULL),
  ('ул. Нахимова', '10', NULL),
  ('ул. Нахимова', '15', NULL),

  ('пр. Комсомольский', '1', NULL),
  ('пр. Комсомольский', '10', NULL),
  ('пр. Комсомольский', '20', NULL),
  ('пр. Комсомольский', '30', NULL),
  ('пр. Комсомольский', '40', NULL),
  ('пр. Комсомольский', '50', NULL),
  ('пр. Комсомольский', '60', NULL),
  ('пр. Комсомольский', '70', NULL),
  ('пр. Комсомольский', '76', NULL),
  ('пр. Комсомольский', '80', NULL),
  ('пр. Комсомольский', '90', NULL),

  ('ул. Усова', '1', NULL),
  ('ул. Усова', '5', NULL),
  ('ул. Усова', '10', NULL),
  ('ул. Усова', '15', NULL),
  ('ул. Усова', '20', NULL),
  ('ул. Усова', '25', NULL),
  ('ул. Усова', '30', NULL),

  ('ул. Елизаровых', '1', NULL),
  ('ул. Елизаровых', '10', NULL),
  ('ул. Елизаровых', '20', NULL),
  ('ул. Елизаровых', '30', NULL),
  ('ул. Елизаровых', '40', NULL),
  ('ул. Елизаровых', '50', NULL),
  ('ул. Елизаровых', '60', NULL),

  ('ул. Гагарина', '1', NULL),
  ('ул. Гагарина', '5', NULL),
  ('ул. Гагарина', '10', NULL),
  ('ул. Гагарина', '15', NULL),
  ('ул. Гагарина', '20', NULL),
  ('ул. Гагарина', '25', NULL),

  ('ул. Советская', '1', NULL),
  ('ул. Советская', '10', NULL),
  ('ул. Советская', '20', NULL),
  ('ул. Советская', '25', NULL),
  ('ул. Советская', '30', NULL),
  ('ул. Советская', '40', NULL),
  ('ул. Советская', '50', NULL),

  ('ул. Пушкина', '1', NULL),
  ('ул. Пушкина', '5', NULL),
  ('ул. Пушкина', '7', NULL),
  ('ул. Пушкина', '10', NULL),
  ('ул. Пушкина', '15', NULL),

  ('пер. Центральный', '1', NULL),
  ('пер. Центральный', '3', NULL),
  ('пер. Центральный', '5', NULL)
ON CONFLICT DO NOTHING;

-- Показываем статистику
SELECT
  COUNT(*) as total_addresses,
  COUNT(DISTINCT street) as unique_streets
FROM zakaz_addresses;

SELECT street, COUNT(*) as houses
FROM zakaz_addresses
GROUP BY street
ORDER BY houses DESC
LIMIT 10;
