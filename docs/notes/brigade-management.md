# Управление бригадами: текущее состояние и модель данных

## Обнаруженные упоминания в текущей документации
- В техническом задании управление и планирование бригад выделены как будущая функция и пока не реализованы.【F:TECHNICAL_SPECIFICATION.md†L26-L40】【F:TECHNICAL_SPECIFICATION.md†L121-L127】【F:TECHNICAL_SPECIFICATION.md†L662-L701】
- Промежуточный отчёт от 17.11 фиксирует, что модуль управления бригадами и календарь загрузки остаются на 0% готовности и включены в план приоритетов 2-3 недель.【F:docs/progress/2025-11-17-compact-ui-optimization.md†L346-L399】
- Итерационный план от 01.11 также отмечает 0% готовности и предлагает таблицы `zakaz_teams`/`zakaz_team_members`, CRUD и назначение заявок на бригады как следующий шаг (Приоритет 3).【F:docs/progress/2025-11-01.md†L372-L399】
- В отчёте по очистке базы фиксируется, что таблицы `zakaz_brigades` и `zakaz_brigade_members` были удалены как неиспользуемые остатки функционала Фазы 2.【F:docs/progress/2025-11-14-database-cleanup-and-file-upload-fix.md†L188-L235】

## Концепция формирования бригады
- Постоянных карточек бригад нет: бригада формируется в момент назначения на объект из списка монтажников (пользователей со статусом "монтажник").
- На один объект можно назначить неограниченное число монтажников; назначение фиксирует состав и роли на конкретную заявку/объект.
- Для аналитики и истории хранится запись о составленной на объект бригаде (фактически — срез состава и параметров на момент назначения).

## Карточка бригады при назначении (минимальные поля)
- **Объект/заявка** — ссылка на объект, для которого формируется состав.
- **Название (опционально)** — удобная метка для назначения (например, «Сборная на ТЦ X»), автоматически формируемая от объекта.
- **Регион / узел** — локация объекта; используется как фильтр для подбора монтажников.
- **Специализации** — совокупность компетенций выбранных монтажников; можно задать требуемые навыки и проверять их покрытие.
- **Контакт ответственного** — один из назначенных монтажников (лидер смены/ответственный), его телефон/мессенджер.
- **Вместимость / параллельные работы** — число слотов/ролей на объекте; ограничивает минимальный/желаемый состав, но не ограничивает верхний предел.
- **Календарь доступности** — пересечение доступности выбранных монтажников для выбора слота; сохраняется факт выбранного интервала.

## Роли и права
- **Admin** — управляет справочником монтажников, статусами доступа и мастер-данными (регионы, узлы, навыки), может редактировать любые составы на объектах.
- **Dispatcher/Operator** — формирует бригаду при назначении заявки, выбирает монтажников и ответственного, фиксирует слот/диапазон работ.
- **Lead/Ответственный монтажник** — назначается в карточке объекта; может подтверждать/корректировать время, отмечать готовность и заменять участников в рамках своего объекта.
- **Engineer/Монтажник** — видит свои назначения и детали объекта, может отмечать фактические статусы/комментарии.

## Управление составом и связями
- Справочник монтажников — база пользователей со статусом "монтажник" и их навыками/доступностью; ведётся централизованно (Admin).
- При назначении создаётся запись «бригада на объект» со списком монтажников и ответственным; один монтажник может входить в несколько одновременно активных составов.
- Изменения состава (замена, добавление) фиксируются как обновления назначения с историей, чтобы отслеживать фактических исполнителей.

## Календарь и загрузка
- Источник правды — индивидуальные календари доступности монтажников; слот для объекта выбирается как пересечение доступных интервалов назначенного состава.
- Метрики загрузки строятся по назначенным слотам монтажников: число активных объектов на монтажника, конфликты и пересечения по времени, прогноз по датам.
## Предлагаемая карточка бригады (минимальные поля)
- **Название** — краткое уникальное имя бригады для поиска и выбора.
- **Регион / узел** — география или опорный узел обслуживания, чтобы фильтровать и назначать по локации.
- **Специализации** — список компетенций (FTTH, медь, Wi-Fi, слаботочка и т.п.) для подбора подходящей бригады.
- **Контакт ответственного** — ФИО и телефон/мессенджер лидера/координатора для оперативной связи.
- **Вместимость / параллельные работы** — количественный лимит одновременно выполняемых заявок (например, 2 параллельно).
- **Календарь доступности** — расписание слотов или диапазонов дат/времени, когда бригада доступна; служит базой для назначения и оценки загрузки.

## Роли и права
- **Admin** — создаёт/архивирует бригады, редактирует все поля, управляет составом и настройками доступности.
- **Lead (руководитель бригады)** — обновляет состав, специализации, временные слоты и текущую загрузку своей бригады; может принимать/отклонять назначения заявок.
- **Dispatcher/Operator** — назначает заявки на доступные бригады, видит их доступность и специализации, может комментировать назначение.
- **Engineer** — только просмотр назначений и статуса своей бригады.

## Управление составом и связями
- Связь «пользователь ↔ бригада» ведётся отдельной таблицей (по аналогии с предложенными `zakaz_team_members`), что позволяет одному сотруднику входить в несколько бригад.
- При назначении заявки фиксируется ссылка на бригаду и конкретного исполнителя, чтобы сохранять историю нагрузки и ответственности.

## Календарь и загрузка
- Источник правды — календарь доступности бригады с возможностью блокировки слотов под уже назначенные заявки.
- Метрики загрузки: число активных назначений, процент занятости слотов и прогноз по датам; отображаются в UI и дашбордах.
